function preload(){}function create(){group1=game.add.group(),group2=game.add.group(),bmd=game.make.bitmapData(winWidth,winHeight),bmd.addToWorld(),stars=[],game.input.onUp.add(onUp,this),rec=new Phaser.Rectangle(0,0,0,0)}function sure(a){game.input.moveCallbacks=[],bmd_draw=game.make.bitmapData(maxX-minX+4,maxY-minY+4);var b=bmd_draw.copy(bmd,minX-2,minY-2,maxX-minX+4,maxY-minY+4,0,0,maxX-minX+4,maxY-minY+4);document.getElementById("draw_result").setAttribute("src",b.canvas.toDataURL()),$(".control").fadeOut(),bmd.clear(),reset(),$(".s1 .btn").fadeOut(),$("#game").removeClass("s1"),$("#game").addClass("s2"),$("#sure").attr("data-id","sure1"),$("#draw_result").animate({left:"0"},2e3,"linear"),$(".bat").animate({width:"1.8rem",right:"0"},4e3,"linear")}function reset(){minX=0,minY=0,maxX=0,maxY=0,init=!0,flag=!0,ifDone=!1}function sure_common(){game.input.moveCallbacks=[],bmd_draw=game.make.bitmapData(maxX-minX+4,maxY-minY+4);var a=bmd_draw.copy(bmd,minX-2,minY-2,maxX-minX+4,maxY-minY+4,0,0,maxX-minX+4,maxY-minY+4);document.getElementById("draw_result1").setAttribute("src",a.canvas.toDataURL()),$("#draw_result1").css({left:(minX-2)/ratio+"rem",top:(minY-2)/ratio+"rem"}),bmd.clear()}function sure1(){sure_common(),reset(),$(".stage2 .tips").fadeOut(),$(".s2 .btn").fadeOut(),$(".stage2").addClass("out"),setTimeout(function(){$("#game").removeClass("s2"),$("#game").addClass("s3"),$("#sure").attr("data-id","sure2")},3500),$("#draw_result1").animate({opacity:"0"},2e3,"linear")}function sure2(){sure_common(),reset(),$("#draw_result1").css("opacity","1"),$(".stage3").addClass("out"),$("#draw_result1").animate({left:"1.9rem",top:"1rem",opacity:"0"},1e3,"linear"),setTimeout(function(){$(".spiderCon .spider").addClass("done")},3e3),setTimeout(function(){$("#game").removeClass("s3"),$("#game").addClass("s4"),$("#sure").attr("data-id","sure3"),$("#draw_result").animate({left:"30%"},2e3,"linear")},5500),$(".stage3 .tips").fadeOut(),$(".s3 .btn").fadeOut()}function sure3(){sure_common(),reset(),$(".stage5").addClass("out"),$("#draw_result1").css("opacity","1"),$("#draw_result1").animate({left:"70%",top:"80%",opacity:"0"},1e3,"linear"),$(".stage5 .tips").fadeOut(),$(".s5 .btn").fadeOut()}function sure4(){sure_common(),$(".stage6 .arrow").css({width:1.5*(maxX-minX)+"px",left:minX+"px",top:minY+(maxY-minY)/2+"px",opacity:"1"}),setTimeout(function(){$(".witchCon").css({"-webkit-transform":"rotateZ(-20deg)"})},1e3),reset(),$(".stage6").addClass("out"),$("#draw_result1").css("opacity","1"),$(".stage6 .tips").fadeOut(),$(".s6 .btn").fadeOut(),$("#draw_result1").animate({opacity:"0"},1e3,"linear"),$(".stage6 .arrow").animate({width:"0.89rem",left:"1.05rem",top:"2.8rem",opacity:"1"},400,"linear")}function onUp(a){flag=!0,rec=new Phaser.Rectangle(minX,minY,maxX-minX,maxY-minY)}function paint(a,b,c){return ifDone||(ifDone=!0),flag&&(beforeX=b,beforeY=c,flag=!1),init&&(maxX=b,minX=b,maxY=c,minY=c,init=!1),b<(winWidth-$(".drawCon").width())/2||b>winWidth-(winWidth-$(".drawCon").width())/2||.2*winHeight>c||c>.2*winHeight+$(".drawCon").height()?(beforeX=b,void(beforeY=c)):(bmd.line(beforeX,beforeY,b,c,"#5C5C5C",2),beforeX=b,beforeY=c,game.input.activePointer.position.x>maxX&&(maxX=b),game.input.activePointer.position.x<minX&&(minX=b),game.input.activePointer.position.y>maxY&&(maxY=c),void(game.input.activePointer.position.y<minY&&(minY=c)))}function paint_all(a,b,c){ifDone||(ifDone=!0),flag&&(beforeX=b,beforeY=c,flag=!1),init&&(maxX=b,minX=b,maxY=c,minY=c,init=!1),bmd.line(beforeX,beforeY,b,c,"#5C5C5C",2),beforeX=b,beforeY=c,game.input.activePointer.position.x>maxX&&(maxX=b),game.input.activePointer.position.x<minX&&(minX=b),game.input.activePointer.position.y>maxY&&(maxY=c),game.input.activePointer.position.y<minY&&(minY=c)}function update(){for(var a=0,b=stars.length;b>a;a++)stars[a].x=stars[a].ox+waveform[stars[a].cx].x,stars[a].y=stars[a].oy+waveform[stars[a].cy].y,stars[a].cx++,stars[a].cx>xl&&(stars[a].cx=0),stars[a].cy++,stars[a].cy>yl&&(stars[a].cy=0)}function render(){}function jssdkIndex(){$.ajax({url:"http://wxjz.zjqq.mobi/data/h5card/index",data:{id:getPar(),url:window.location.href},type:"POST",dataType:"json",success:function(a){"ok"==a.state?(wx.config({debug:!1,appId:a.data.signPackage.appId,timestamp:a.data.signPackage.timestamp,nonceStr:a.data.signPackage.nonceStr,signature:a.data.signPackage.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone","checkJsApi","addCard"]}),wx.ready(function(){wx.onMenuShareAppMessage(shareData),wx.onMenuShareTimeline(shareData),wx.onMenuShareQQ(shareData),wx.onMenuShareWeibo(shareData),wx.onMenuShareQZone(shareData)}),cardid=a.data.signCard.cardId,nonce_str=a.data.signCard.nonce_str,timestamp=a.data.signCard.timestamp,signature=a.data.signCard.signature):console.log(a.msg)}})}function getPar(){var a=document.location.href,b=a.lastIndexOf("#")>-1?a.substring(a.lastIndexOf("#")+1):"";return b}function lazyLoad(a){$(a).each(function(a,b){$(b).attr("src",$(b).attr("data-src"))})}var winWidth=window.innerWidth,winHeight=window.innerHeight,ratio=parseInt(document.getElementsByTagName("html")[0].style.fontSize),game,points=[],bmd,beforeX,beforeY,flag=!0,init=!0,ifDone=!1,minX=0,minY=0,maxX=0,maxY=0,rec,button,bmd_draw,group1,group2,mySwiper;game=new Phaser.Game(winWidth,winHeight,Phaser.CANVAS,"game",{preload:preload,create:create,update:update,render:render},!0),Pace.on("hide",function(){$(".container").addClass("cover"),lazyLoad(".stage1 img")}),$(function(){jssdkIndex(),$(document).on("touchstart",".page_cover",function(a){a.preventDefault()});for(var a=0;100>a;a++){var b=parseInt(2*Math.random()+3),c=(100*Math.random()).toFixed(1),d=(100*Math.random()).toFixed(1),e=Math.random().toFixed(1),f='<i style="-webkit-animation-delay:'+e+"s;width: "+b+"px;height:"+b+"px;left:"+c+"%;top:"+d+'%;background-color:#fff;"></i>';$("#star").append(f)}audiojs.events.ready(function(){audiojs.create(document.getElementsByTagName("audio")[0],{css:!1,createPlayer:{markup:!1,playPauseClass:"play-pauseZ",scrubberClass:"scrubberZ",progressClass:"progressZ",loaderClass:"loadedZ",timeClass:"timeZ",durationClass:"durationZ",playedClass:"playedZ",errorMessageClass:"error-messageZ",playingClass:"playingZ"}})}),$(document).on("webkitAnimationEnd",".page_cover .bottom .start",function(){$(document).on("tap",".page_cover",function(){$(".container").removeClass("cover"),$(".page_cover").addClass("out"),setTimeout(function(){$(".container").addClass("game"),$("#game").addClass("s1"),lazyLoad(".stage2 img")},3200)})}),$(document).on("webkitAnimationEnd",".stage1 .text.text2",function(){game.input.addMoveCallback(paint,this),$(".s1 .btn").fadeIn()}),$(document).on("webkitAnimationEnd",".stage2 .text.text2",function(){game.input.addMoveCallback(paint_all,this),$(".s2 .btn").fadeIn(),lazyLoad(".stage3 img")}),$(document).on("webkitAnimationEnd",".stage3 .text.text1",function(){game.input.addMoveCallback(paint_all,this),$(".s3 .btn").fadeIn(),lazyLoad(".stage4 img"),lazyLoad(".stage5 img")}),$(document).on("webkitAnimationEnd",".stage4 .text.text2",function(){$("#game").removeClass("s4"),$("#game").addClass("s5"),setTimeout(function(){$(".devilCon").animate({"-webkit-transform":"translateX(-100%)"},2e3,"linear")},2e3),$("#draw_result").animate({left:"0"},2e3,"linear")}),$(document).on("webkitAnimationEnd",".stage5 .text.text2",function(){game.input.addMoveCallback(paint_all,this),$(".s5 .btn").fadeIn(),lazyLoad(".stage6 img")}),$(document).on("webkitAnimationEnd",".stage5 .text.text3",function(){$("#game").removeClass("s5"),$("#game").addClass("s6"),$("#sure").attr("data-id","sure4")}),$(document).on("webkitAnimationEnd",".stage6 .text.text2",function(){game.input.addMoveCallback(paint_all,this),$(".s6 .btn").fadeIn(),lazyLoad(".stage7 img")}),$(document).on("webkitAnimationEnd",".stage6 .text.text3",function(){$(".stage6 .arrow").hide(),$("#draw_result").animate({opacity:"0"},2e3,"linear"),$("canvas").css("display","none"),$("#game").removeClass("s6"),$("#game").addClass("s7"),mySwiper=new Swiper(".swiper-container",{pagination:".swiper-pagination",prevButton:".swiper-button-prev",nextButton:".swiper-button-next"})}),$(document).on("tap","#sure",function(){if(ifDone){var a=$(this).attr("data-id");switch(a){case"sure":sure();break;case"sure1":sure1();break;case"sure2":sure2();break;case"sure3":sure3();break;case"sure4":sure4()}}}),$(document).on("tap",".again",function(){reset(),bmd.clear()}),$(document).on("tap",".stage7 .zh",function(){$(".stage7").addClass("active")}),$(document).one("webkitAnimationEnd",".stage7 .resultCon",function(){$(".stage7 .resultCon,.stage7 .btnGroup").addClass("out")}),$(document).on("tap",".stage7 .btnGroup .button",function(){var a=$(this).attr("data-id");switch(a){case"more":window.location.reload();break;case"share":$(".stage7 .shareCon").fadeIn();break;case"detail":$(".swiperCon").addClass("active");break;case"card":wx.addCard({cardList:[{cardId:cardid,cardExt:'{"nonce_str":"'+nonce_str+'","timestamp":"'+timestamp+'","signature":"'+signature+'"}'}],success:function(a){alert("�����ӿ�ȯ")}})}}),$(document).on("tap",".stage7 .swiperCon .close",function(){$(".swiperCon").removeClass("active")}),$(document).on("tap",".stage7 .resultCon .color",function(){$(".swiperCon").addClass("active");var a=$(this).attr("data-index");mySwiper.slideTo(a,1e3,!1)}),$(document).on("tap",".stage7 .shareCon",function(){$(this).fadeOut()})});