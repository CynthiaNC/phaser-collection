var winWidth=window.innerWidth,winHeight=window.innerHeight,Game={init:function(){var a=this;a.game=new Phaser.Game(winWidth,winHeight,Phaser.AUTO,"game",{preload:a.preload,create:a.create,update:a.update,render:a.render},!0)},preload:function(){var a=this;a.left=.68*ratio,a.top=.6*ratio,a.player_v=100,a.index=0,a.diceCan=!1,a.diceNum=!1,a.flag=!0,a.direction=!0,a.speak_dir="",a.game.load.image("bg","images/repeat.jpg"),a.game.load.spritesheet("dice","images/dice_group.png",50,50,10),a.game.load.spritesheet("player","images/player.png",82,108,8),a.game.load.image("background","images/background.png"),a.game.load.spritesheet("speak_group","images/speak_group.png",338,232,4),a.game.load.spritesheet("diceBtn","images/btn_group.png",180,124,2),a.game.load.image("numCon","images/numCon.png",65,65)},create:function(){var a=this;a.game.physics.startSystem(Phaser.Physics.ARCADE),a.game.world.setBounds(0,0,winWidth,19.3*ratio+200),a.playDice=function(){var a=this;if(a.diceCan){result.r4.num++,a.dice.animations.play("diceRun"),a.dice_btn.animations.play("btnRun");var b=parseInt(100*Math.random())+100;a.dice.body.velocity.y=-1*b,a.diceCan=!1,a.diceNum=!0,a.speak_con.visible=!1}},a.collideHandle=function(){if(a.diceNum){a.dice.animations.stop("diceRun"),a.dice_btn.animations.stop("btnRun");var b=parseInt(6*Math.random());a.dice.frame=b+4,a.diceNum=!1,a.goDes(b+1,function(){var b=jsonData[a.index];a.initSpeak(b.speak,b)})}},a.goDes=function(b,c){return a.diceCan=!1,0==b?void c():(b>0&&(a.direction=!0,b-=1,a.goTo(jsonData[a.index],jsonData[++a.index],function(){a.goDes(b,c)})),void(b<0&&(a.direction=!1,b+=1,a.goTo(jsonData[a.index],jsonData[--a.index],function(){a.goDes(b,c)}))))},a.initSpeak=function(b,c){if(c.result&&(result[c.result].num++,console.log(result)),b){switch(a.speak_dir=b,a.text.text=c.text,$(".infoCon").fadeIn(200),$("#text h1").html(c.alertInfo.h1),$("#text p").html(c.alertInfo.p),b){case"0":a.speak.anchor.set(.9,1.2),a.text.anchor.set(.9,1.2),a.speak.frame=0;break;case"1":a.speak.anchor.set(.1,1.2),a.text.anchor.set(0,1.2),a.speak.frame=1;break;case"2":a.speak.anchor.set(.9,-.1),a.text.anchor.set(.9,-.1),a.speak.frame=2}$(document).one("tap",".page3 .infoCon",function(){if("stop"==c.alertInfo.status)a.stopThree();else{var b=parseInt(c.alertInfo.status);console.log(b),b>0?result.r6.num++:result.r5.num++,a.goDes(b,function(){a.initSpeak(jsonData[a.index].speak,jsonData[a.index]),a.speak_con.visible=!1,a.diceCan=!0})}a.speak_con.visible=!0,$(this).fadeOut(200)})}else a.diceCan=!0},a.stopThree=function(){setTimeout(function(){a.diceCan=!0},3e3)},a.goTo=function(a,b,c){var d=this,e=parseInt(Math.abs((parseInt(b.x)-parseInt(a.x))/100*ratio/d.player_v*1e3)),f=parseInt(Math.abs((parseInt(b.y)-parseInt(a.y))/100*ratio/d.player_v*1e3));d.direction?d.player.play(a.dir):d.player.play(a._dir),e>0&&(parseInt(b.x)-parseInt(a.x)>0?d.player.body.velocity.x+=d.player_v:d.player.body.velocity.x-=d.player_v,setTimeout(function(){d.player.body.velocity.x=0,c()},e)),f>0&&(parseInt(b.y)-parseInt(a.y)>0?d.player.body.velocity.y+=d.player_v:d.player.body.velocity.y-=d.player_v,setTimeout(function(){d.player.body.velocity.y=0,c()},f))},a.initPlayer=function(){var a=this,b=a.game.add.tween(a.player).to({y:a.top+.77*ratio},1e3,Phaser.Easing.Linear.None,!0,0,0),c={x:0,y:"77"};b.onComplete.add(function(){a.player.animations.play("player_right"),a.goTo(c,jsonData[0],function(){a.diceCan=!0})},this)},a.game_group=a.game.add.group(),a.dice_group=a.game.add.group(),a.speak_con=a.game.add.group(),a.bg=a.game.add.image(a.left,a.top,"background"),a.bg.width=5.2*ratio,a.bg.height=19.3*ratio,a.game_group.add(a.bg),a.dice_btn=a.game.add.sprite(winWidth-.52*ratio,winHeight-20,"diceBtn",0),a.dice_btn.width=1.8*ratio,a.dice_btn.height=1.24*ratio,a.dice_btn.anchor.set(1,1),a.game.physics.arcade.enable(a.dice_btn),a.dice_btn.body.setSize(2*a.dice_btn.width,5,0,-20),a.dice_btn.body.immovable=!0,a.dice_btn.inputEnabled=!0,a.dice_btn.events.onInputDown.add(a.playDice,this),a.dice_btn.animations.add("btnRun",[0,1],10,!0),a.dice_group.add(a.dice_btn),a.dice=a.game.add.sprite(winWidth-1.5*ratio,winHeight-95,"dice",4),a.dice.width=1*ratio,a.dice.height=1*ratio,a.dice.anchor.set(1,1),a.dice_group.add(a.dice),a.game.physics.arcade.enable(a.dice),a.dice.body.gravity.y=200,a.dice.body.bounce.set(.5),a.dice.body.collideWorldBounds=!0,a.dice.animations.add("diceRun",[0,1,2,3],20,!0),a.player=a.game.add.sprite(a.left,0,"player"),a.player.anchor.set(.6,.8),a.player.width=.82*ratio,a.player.height=1.08*ratio,a.game.physics.arcade.enable(a.player),a.player.animations.add("player_back",[0,1],5,!0),a.player.animations.add("player_left",[2,3],5,!0),a.player.animations.add("player_down",[4,5],5,!0),a.player.animations.add("player_right",[6,7],5,!0),a.player.animations.play("player_down"),a.speak=a.game.add.sprite(0,0,"speak_group",1),a.speak.width=3.38*ratio,a.speak.height=2.32*ratio,a.speak_con.add(a.speak);var b={font:.3*ratio+"px myFont",wordWrap:!0,wordWrapWidth:.9*a.speak.width,align:"center"};a.text=a.game.add.text(a.game.world.centerX,100,"2016哈哈哈 \n2016哈哈 2016哈哈哈 2016哈哈",b),a.speak_con.add(a.text),a.speak_con.visible=!1,a.cursors=a.game.input.keyboard.createCursorKeys(),a.dice_group.fixedToCamera=!0,a.game.camera.follow(a.player),a.initPlayer(),console.log(a.speak_con),a.game_group.add(a.speak_con),a.game_group.add(a.dice_group)},update:function(){var a=this;switch(a.game.physics.arcade.collide(a.dice_btn,a.dice,a.collideHandle),a.speak.y=a.player.y,a.speak.x=a.player.x,a.speak_dir){case"0":a.text.y=a.player.y-1.2*ratio,a.text.x=a.player.x-.05*a.speak.width+.1*a.text.width/2;break;case"1":a.text.y=a.player.y-1.2*ratio,a.text.x=a.player.x-.05*a.speak.width;break;case"2":a.text.y=a.player.y+.8*ratio,a.text.x=a.player.x-.05*a.speak.width}a.cursors.left.isDown&&a.flag&&(a.direction=!1,a.goTo(jsonData[a.index],jsonData[--a.index],function(){a.flag=!0}),a.flag=!1),a.cursors.right.isDown&&a.flag&&(a.direction=!0,a.goTo(jsonData[a.index],jsonData[++a.index],function(){a.flag=!0}),a.flag=!1)},render:function(){var a=this;a.game.debug.geom(a.circle,"#a00"),a.game.debug.body(a.text),a.game.debug.text("前进:"+result.r6.num+"次",a.game.world.centerX,30,"#a00","40px Courier"),a.game.debug.text("后退:"+result.r5.num+"次",a.game.world.centerX,80,"#a00","40px Courier"),a.game.debug.text("总共:"+result.r4.num+"次",a.game.world.centerX,130,"#a00","40px Courier")}};$(function(){Game.init(),$(".page1").bind("tap",function(){$(this).removeClass("active").addClass("out"),setTimeout(function(){$(".page1").fadeOut(200),$(".page2").addClass("active")},2e3)}),$(document).on("webkitAnimationEnd",".page2.active .user",function(){$(".page2").removeClass("active").addClass("out")})});